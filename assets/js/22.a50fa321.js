(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{245:function(t,a,e){"use strict";e.r(a);var s=e(0),r=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"手动验签"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#手动验签"}},[t._v("#")]),t._v(" 手动验签")]),t._v(" "),e("p",[t._v("Pagsmile-Signature标头大概内容如下所示（此处为方便查看带有换行，实际内容全部在一行内）：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Pagsmile-Signature:\nt=1577808000,\nv2=5257a869e7ecebeda32affa62cdca3fa51cad7e77a0e56ff536d0ce8e108d8bd\n")])])]),e("p",[t._v("Pagsmile-Signature标头中都包含一个时间戳和一个签名。时间戳记以t=为前缀，后面跟随一个UNIX时间戳；签名以v2=为前缀，后面跟随签名内容。")]),t._v(" "),e("p",[t._v("发送的通知使用以下格式：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('Content-Type: application/json\nMethod: POST\nHeader: Pagsmile-Signature\nBody:\n  {\n    "trade_no":"",\n  \t"out_trade_no":"",\n  \t"out_request_no":"",\n  \t"app_id":"",\n  \t"trade_status":"",\n  \t"amount":"",\n  \t"method":"",\n  \t"currency":"",\n    "timestamp":""\n  }\n')])])]),e("h3",{attrs:{id:"第一步：从标头中提取时间戳和签名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第一步：从标头中提取时间戳和签名"}},[t._v("#")]),t._v(" 第一步：从标头中提取时间戳和签名")]),t._v(" "),e("p",[t._v("使用[,]字符作为分隔符拆分标题，以获取元素列表。然后使用[=]字符作为分隔符拆分每个元素，以获取前缀和值对。")]),t._v(" "),e("p",[t._v("前缀的值t对应于时间戳，v2对应于签名内容；您可以丢弃所有其他元素。")]),t._v(" "),e("h3",{attrs:{id:"第二步：准备原始签名内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第二步：准备原始签名内容"}},[t._v("#")]),t._v(" 第二步：准备原始签名内容")]),t._v(" "),e("p",[t._v("获取RequestBody内所有内容，此处需注意，请不要使用程序自建结构体对RequestBody内容进行格式化和序列化操作，如有类似需求，请在拿到原始数据进行验签后进行，避免非必要的字段排序和字符添加对签名造成影响。")]),t._v(" "),e("h3",{attrs:{id:"第三步：确定签名方法和密钥，获取预期签名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第三步：确定签名方法和密钥，获取预期签名"}},[t._v("#")]),t._v(" 第三步：确定签名方法和密钥，获取预期签名")]),t._v(" "),e("p",[t._v("使用SHA256哈希函数计算HMAC。使用商户后台获得的SecretKey作为密钥（盐值），并使用原始RequestBody字符串作为消息。")]),t._v(" "),e("h3",{attrs:{id:"第四步：比较签名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第四步：比较签名"}},[t._v("#")]),t._v(" 第四步：比较签名")]),t._v(" "),e("p",[t._v("将标头中的签名与期望的签名进行比较。对于相等匹配，请计算当前时间戳和接收的时间戳之间的差，然后确定该差是否在容忍范围内。")])])}),[],!1,null,null,null);a.default=r.exports}}]);