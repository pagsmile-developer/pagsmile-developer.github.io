<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Verifying signatures manually | Developers</title>
    <meta name="description" content="Pagsmile Docs for Developers">
    
    
    <link rel="preload" href="/assets/css/0.styles.b4b7b21d.css" as="style"><link rel="preload" href="/assets/js/app.e7355f32.js" as="script"><link rel="preload" href="/assets/js/2.97fc30e0.js" as="script"><link rel="preload" href="/assets/js/42.47231c15.js" as="script"><link rel="prefetch" href="/assets/js/10.20f0a5aa.js"><link rel="prefetch" href="/assets/js/11.83aca990.js"><link rel="prefetch" href="/assets/js/12.cdc4e54b.js"><link rel="prefetch" href="/assets/js/13.e979f3d1.js"><link rel="prefetch" href="/assets/js/14.60fd9197.js"><link rel="prefetch" href="/assets/js/15.632c63a4.js"><link rel="prefetch" href="/assets/js/16.c6654a6f.js"><link rel="prefetch" href="/assets/js/17.514c69b7.js"><link rel="prefetch" href="/assets/js/18.df33fc72.js"><link rel="prefetch" href="/assets/js/19.a35e96a3.js"><link rel="prefetch" href="/assets/js/20.b7d627ae.js"><link rel="prefetch" href="/assets/js/21.07885a22.js"><link rel="prefetch" href="/assets/js/22.af2f2e7a.js"><link rel="prefetch" href="/assets/js/23.a0691c2c.js"><link rel="prefetch" href="/assets/js/24.adfe13c5.js"><link rel="prefetch" href="/assets/js/25.da403a81.js"><link rel="prefetch" href="/assets/js/26.16e5d180.js"><link rel="prefetch" href="/assets/js/27.7ac32586.js"><link rel="prefetch" href="/assets/js/28.9a0b39c6.js"><link rel="prefetch" href="/assets/js/29.bb715969.js"><link rel="prefetch" href="/assets/js/3.d2615c96.js"><link rel="prefetch" href="/assets/js/30.17a66ffa.js"><link rel="prefetch" href="/assets/js/31.ee9a409b.js"><link rel="prefetch" href="/assets/js/32.90267251.js"><link rel="prefetch" href="/assets/js/33.3a204d7a.js"><link rel="prefetch" href="/assets/js/34.fb6a6cb4.js"><link rel="prefetch" href="/assets/js/35.6873a174.js"><link rel="prefetch" href="/assets/js/36.33f78519.js"><link rel="prefetch" href="/assets/js/37.c5bb8220.js"><link rel="prefetch" href="/assets/js/38.ab7b0bfb.js"><link rel="prefetch" href="/assets/js/39.89d308c1.js"><link rel="prefetch" href="/assets/js/4.65669590.js"><link rel="prefetch" href="/assets/js/40.8aa607e5.js"><link rel="prefetch" href="/assets/js/41.e136cb59.js"><link rel="prefetch" href="/assets/js/43.18139357.js"><link rel="prefetch" href="/assets/js/44.d6a772e6.js"><link rel="prefetch" href="/assets/js/45.31744c7d.js"><link rel="prefetch" href="/assets/js/46.787d6e84.js"><link rel="prefetch" href="/assets/js/5.3b1dab4c.js"><link rel="prefetch" href="/assets/js/6.fd1cc7df.js"><link rel="prefetch" href="/assets/js/7.931e70ef.js"><link rel="prefetch" href="/assets/js/8.e5432fd1.js"><link rel="prefetch" href="/assets/js/9.a4a6a312.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4b7b21d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><img src="/pagsmile-logo-long.png" alt="Developers" class="logo"> <span class="site-name can-hide">Developers</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/reference/" class="nav-link router-link-active">API Reference</a></div><div class="nav-item"><a href="/en/changelog.html" class="nav-link">Changelog</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">Home</a></li><li class="dropdown-item"><!----> <a href="/en/reference/signatures-verify-manually.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/cn/reference/signatures-verify-manually.html" class="nav-link">简体中文</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/reference/" class="nav-link router-link-active">API Reference</a></div><div class="nav-item"><a href="/en/changelog.html" class="nav-link">Changelog</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">Home</a></li><li class="dropdown-item"><!----> <a href="/en/reference/signatures-verify-manually.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/cn/reference/signatures-verify-manually.html" class="nav-link">简体中文</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Payments</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Notifications</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SDKs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Data</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="verifying-signatures-manually"><a href="#verifying-signatures-manually" class="header-anchor">#</a> Verifying signatures manually</h1> <p>The approximate content of the Pagsmile-Signature header is as follows (here with line breaks for easy viewing, the actual content is all on one line):</p> <div class="language- extra-class"><pre class="language-text"><code>Pagsmile-Signature:
t=1577808000,
v2=5257a869e7ecebeda32affa62cdca3fa51cad7e77a0e56ff536d0ce8e108d8bd
</code></pre></div><p>The Pagsmile-Signature header contains a timestamp and a signature. The timestamp is prefixed by t=, followed by a UNIX timestamp; the signature is prefixed by v2=, followed by the signature content.</p> <p>The notification sent uses the following format:</p> <div class="language- extra-class"><pre class="language-text"><code>Content-Type: application/json
Method: POST
Header: Pagsmile-Signature
Body:
  {
    &quot;trade_no&quot;:&quot;&quot;,
  	&quot;out_trade_no&quot;:&quot;&quot;,
  	&quot;out_request_no&quot;:&quot;&quot;,
  	&quot;app_id&quot;:&quot;&quot;,
  	&quot;trade_status&quot;:&quot;&quot;,
  	&quot;amount&quot;:&quot;&quot;,
  	&quot;method&quot;:&quot;&quot;,
  	&quot;currency&quot;:&quot;&quot;,
    &quot;timestamp&quot;:&quot;&quot;
  }
</code></pre></div><h3 id="step-1-extract-the-timestamp-and-signatures-from-the-header"><a href="#step-1-extract-the-timestamp-and-signatures-from-the-header" class="header-anchor">#</a> Step 1 : Extract the timestamp and signatures from the header</h3> <p>Split the header using the [,] character as the separator, to get a list of elements. Then split each element using the [=] character as the separator, to get a prefix and value pair.</p> <p>The value for the prefix [t] corresponds to the timestamp, and [v2] corresponds to the signature. You can discard all other elements.</p> <h3 id="step-2-prepare-the-original-requestbody-string"><a href="#step-2-prepare-the-original-requestbody-string" class="header-anchor">#</a> Step 2 : Prepare the original RequestBody string</h3> <p>Get all the content in the RequestBody. Please pay attention here. Please do not use the program's self-built structure to format and/or serialize the RequestBody content. If you have similar requirements, please do it after getting the original data for verification to avoid unnecessary sorting of fields and the addition of characters affect the signature.</p> <h3 id="step-3-determine-the-expected-signature"><a href="#step-3-determine-the-expected-signature" class="header-anchor">#</a> Step 3 : Determine the expected signature</h3> <p>Compute an HMAC with the SHA256 hash function. Use the SecretKey get from The merchant dashboard as the key(salt), and use the original RequestBody string as the message.</p> <h3 id="step-4-compare-the-signatures"><a href="#step-4-compare-the-signatures" class="header-anchor">#</a> Step 4 : Compare the signatures</h3> <p>Compare the signature in the header to the expected signature. For an equality match, compute the difference between the current timestamp and the received timestamp, then decide if the difference is within your tolerance.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e7355f32.js" defer></script><script src="/assets/js/2.97fc30e0.js" defer></script><script src="/assets/js/42.47231c15.js" defer></script>
  </body>
</html>
